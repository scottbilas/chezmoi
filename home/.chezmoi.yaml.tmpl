format: yaml
pager: delta

{{- $beyond_compare_dirf := "" }}
{{ if eq .chezmoi.os "windows" }}
cd:
  command: pwsh
  args: [-NoExit, -Command, "& Set-Location (chezmoi source-path)"]

{{ $beyond_compare_dirf = output "pwsh" "-Command" "& { Get-Content -ea:silent Alias:bc || '' }" | trim -}}
{{   if ne $beyond_compare_dirf "" -}}
{{     $beyond_compare_dirf = $beyond_compare_dirf | replace "\\" "/" | dir -}}
diff:
  command: {{$beyond_compare_dirf}}/bcomp.exe

merge:
  command: pwsh
  args: [{{.profile.home_dirf}}/.config/chezmoi/merge.ps1, -BeyondCompare, -Destination, '{{`{{ .Destination }}`}}', -Source, '{{`{{ .Source }}`}}', -Target, '{{`{{ .Target }}`}}']
{{-   else }}{{/* can happen if posh profile not applied yet */ -}}
diff:
  command: kdiff3

merge:
  command: pwsh
  args: [{{.profile.home_dirf}}/.config/chezmoi/merge.ps1, -KDiff3, -Destination, '{{`{{ .Destination }}`}}', -Source, '{{`{{ .Source }}`}}', -Target, '{{`{{ .Target }}`}}']
{{-   end }}
{{- end }}

interpreters.ps1:
  command: pwsh

#git:
#  autoCommit: true   # not sure i like this yet

data:
  profile:
{{- if ne $beyond_compare_dirf "" }}
    beyond_compare_dirf: {{$beyond_compare_dirf}}
{{- end }}
{{- /* TODO: autodetect this... */}}
{{- $personal_machine := get .profile "personal_machine" }}
{{- if not (hasKey .profile "personal_machine") }}
{{-   $personal_machine = promptBool "\n>>> Personal machine? (y/n): " }}
{{- end }}
    home_dirf: {{.chezmoi.homeDir | replace "\\" "/"}}
    home_dirb: {{.chezmoi.homeDir | replace "/" "\\"}}
    personal_machine: {{$personal_machine}}
    theme: dark # updated in the dst file by Set-DarkMode
